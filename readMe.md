
### 配置ndk

as -> sdk -> ndk下载

### 配置External Tools

#### javah

Program:$JDKPath$/bin/javah

Parameters:-classpath $Classpath$ -v -jni $FileClass$

Working directory:$SourcepathEntry$/../jni

#### ndk-build

Program:/Users/Diablo/Library/Android/sdk/ndk-bundle/ndk-build

Parameters:~

Working directory:$ProjectFileDir$/app/src/main

#### ndk-build-clean

Program:/Users/Diablo/Library/Android/sdk/ndk-bundle/ndk-build

Parameters:clean

Working directory:$ProjectFileDir$/app/src/main

### 使用

local.properties配置：

```java
ndk.dir=/Users/Diablo/Library/Android/sdk/ndk-bundle
```

gradle.properties配置：

```java
android.useDeprecatedNdk=true
```

app/build配置

```xml
defaultConfig {
        ndk {
            moduleName "TradeC"
            stl "stlport_static"
            ldLibs "log"
        }
        sourceSets.main{
            jni.srcDirs = []
            jniLibs.srcDir "src/main/libs"
        }
    }
```

* moduleName	模块名称，即编译出来的.so的名字
* stl 默认情况下JNI中是无法使用STL标准库的，加入此字段表示使用STL标准库。
* ldLibs (#include <android/log.h>)
就可以使用__android_log_print方法打印日志到logcat中。

### 使用

#### 1 新建jni文件夹
app右键 -> new -> folder -> jni foider

#### 2 新建MyNdk.java

```java
public class MyNdk {
    static {
        System.loadLibrary("MyLibrary");    
}   
    public native String getString();
}
```

* 注：声明jni的方法必须带有native关键字，否则将视为一般的方法。设置native的方法允许为静态/非静态方法（即加或不加static关键字）。

#### 3 右键MyNdk -> External Tools -> javah
执行后在jni文件夹会自动生成一个包名_MyNdk.h文件，包含了MyNdk.java里面生成的native方法。

#### 4 然后我们在jni目录下编写 MyLibrary.cpp、Android.mk、Application.mk这三个文件

```java
包名_MyNdk.h
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class com_zhangyp_higo_myndk_MyNdk */

#ifndef _Included_com_zhangyp_higo_myndk_MyNdk
#define _Included_com_zhangyp_higo_myndk_MyNdk
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_zhangyp_higo_myndk_MyNdk
 * Method:    getString
 * Signature: ()Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_com_zhangyp_higo_myndk_MyNdk_getString
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif

MyLibrary.cpp

#include "com_zhangyp_higo_myndk_MyNdk.h"

JNIEXPORT jstring JNICALL Java_com_zhangyp_higo_myndk_MyNdk_getString
  (JNIEnv * env, jobject obj){
   return (*env).NewStringUTF("This is mylibrary !!!");
  }
  
Android.mk

LOCAL_PATH := $(call my-dir)

include $(CLEAR_VARS)

LOCAL_MODULE := MyLibrary
LOCAL_SRC_FILES =: MyLibrary.cpp
include $(BUILD_SHARED_LIBRARY)

Application.mk

APP_MODULES := MyLibrary
APP_ABI := all
```

#### 5 生成.so文件，在jni文件夹右键执行ndk-build

#### 6 使用

```java
new MyNdk().getString()
```